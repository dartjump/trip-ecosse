<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ Scotland Roadtrip 2026</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
:root {
  --green: #1a3a2a;
  --gold: #c9a84c;
  --cream: #f4efe6;
  --mist: #7a9a8a;
  --dark: #0d1f17;
  --light: #e8f0eb;
  --red: #8b3a1a;
  --blue: #1a4a6b;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { height: 100%; overflow: hidden; margin: 0; }
body { font-family: 'Lato', sans-serif; background: var(--cream); color: var(--dark); }

/* â”€â”€â”€ NAV â”€â”€â”€ */
header {
  background: var(--green);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 16px;
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 9999;
  height: 60px;
  box-shadow: 0 2px 20px rgba(0,0,0,0.4);
}
.logo {
  font-family: 'Playfair Display', serif;
  color: var(--gold);
  font-size: 1.1rem;
  white-space: nowrap;
}
.logo small { color: rgba(255,255,255,0.5); font-size: 0.6rem; display: block; letter-spacing: 2px; font-family: 'Lato'; font-style: normal; }
nav { display: flex; gap: 3px; }
nav button {
  background: rgba(255,255,255,0.08);
  border: none;
  color: rgba(255,255,255,0.65);
  padding: 7px 11px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.72rem;
  letter-spacing: 0.5px;
  transition: all 0.25s;
  font-family: 'Lato';
}
nav button.active { background: var(--gold); color: var(--dark); font-weight: 700; }
nav button:hover:not(.active) { background: rgba(255,255,255,0.15); color: #fff; }

/* â”€â”€â”€ SECTIONS â”€â”€â”€ */
.section { display: none; position: fixed; top: 60px; left: 0; right: 0; bottom: 0; overflow-y: auto; }
.section.active { display: block; }

/* â”€â”€â”€ PLANNING â”€â”€â”€ */
#planning {
  display: none;
  flex-direction: row;
  gap: 0;
  background: var(--dark);
}
#planning.active { display: flex; }

.steps-sidebar {
  width: 260px;
  min-width: 260px;
  overflow-y: auto;
  background: #0d1f17;
  border-right: 1px solid rgba(255,255,255,0.07);
  flex-shrink: 0;
}
.sidebar-title {
  padding: 16px;
  color: var(--gold);
  font-size: 0.65rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  border-bottom: 1px solid rgba(255,255,255,0.07);
  font-weight: 700;
}
.step-item {
  padding: 12px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  cursor: pointer;
  transition: background 0.2s;
  display: grid;
  grid-template-columns: 48px 1fr 40px;
  align-items: center;
  gap: 10px;
}
.step-item:hover { background: rgba(201,168,76,0.08); }
.step-item.active { background: rgba(201,168,76,0.15); border-left: 3px solid var(--gold); }
.step-num {
  text-align: center;
  font-family: 'Playfair Display', serif;
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--gold);
  line-height: 1;
}
.step-num small { display: block; font-family: 'Lato'; font-size: 0.6rem; color: var(--mist); font-weight: 300; letter-spacing: 1px; }
.step-name { color: #fff; font-size: 0.82rem; font-weight: 700; margin-bottom: 2px; }
.step-from { color: var(--mist); font-size: 0.68rem; }
.step-km-badge { color: var(--gold); font-size: 0.7rem; font-weight: 700; text-align: right; }
.step-km-badge small { display: block; color: var(--mist); font-size: 0.6rem; font-weight: 300; }

.step-detail-panel {
  flex: 1;
  overflow-y: auto;
  background: var(--cream);
  padding: 28px 28px 40px;
}
.detail-header { margin-bottom: 24px; }
.detail-day-label { color: var(--mist); font-size: 0.72rem; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 6px; }
.detail-title { font-family: 'Playfair Display', serif; font-size: 2.2rem; color: var(--green); line-height: 1.1; margin-bottom: 4px; }
.detail-subtitle { color: var(--mist); font-size: 0.85rem; }
.detail-stats { display: flex; gap: 16px; margin: 16px 0 24px; }
.dstat { background: var(--green); color: #fff; padding: 10px 16px; border-radius: 10px; text-align: center; }
.dstat strong { display: block; font-family: 'Playfair Display', serif; font-size: 1.4rem; color: var(--gold); }
.dstat span { font-size: 0.65rem; opacity: 0.7; letter-spacing: 1px; text-transform: uppercase; }

.tiles-section-title { font-size: 0.65rem; letter-spacing: 3px; text-transform: uppercase; color: var(--mist); margin-bottom: 12px; font-weight: 700; }
.tiles-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 24px; }
.tile {
  border-radius: 12px;
  padding: 14px 16px;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: transform 0.2s, box-shadow 0.2s;
  box-shadow: 0 2px 10px rgba(0,0,0,0.12);
  cursor: pointer;
}
.tile:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.2); }
.tile-icon { font-size: 1.5rem; flex-shrink: 0; }
.tile-body {}
.tile-body strong { display: block; color: #fff; font-size: 0.82rem; font-weight: 700; margin-bottom: 2px; }
.tile-body span { color: rgba(255,255,255,0.75); font-size: 0.7rem; line-height: 1.3; }
.tile.t-hotel { background: linear-gradient(135deg, #2d6b47, #1a3a2a); }
.tile.t-resto { background: linear-gradient(135deg, #a0441f, #6b2010); }
.tile.t-walk  { background: linear-gradient(135deg, #1e7a50, #0d4a30); }
.tile.t-castle{ background: linear-gradient(135deg, #5a4520, #3a2d10); }
.tile.t-nature{ background: linear-gradient(135deg, #1a557a, #0d3050); }
.tile.t-museum{ background: linear-gradient(135deg, #72206a, #4a1045); }
.tile.t-transport { background: linear-gradient(135deg, #2a2a7a, #101060); }

.poi-block { margin-top: 8px; }
.poi-list { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
.poi-chip {
  background: rgba(26,58,42,0.1);
  border: 1px solid rgba(26,58,42,0.2);
  color: var(--green);
  padding: 4px 12px;
  border-radius: 50px;
  font-size: 0.75rem;
  font-weight: 700;
}

/* â”€â”€â”€ MAP â”€â”€â”€ */
#map-section { padding: 0; overflow: hidden; }
#leaflet-map { width: 100%; height: calc(100vh - 60px); }

/* â”€â”€â”€ METEO â”€â”€â”€ */
#meteo { background: var(--cream); padding: 24px 20px 40px; }
.page-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; color: var(--green); margin-bottom: 6px; }
.page-sub { color: var(--mist); font-size: 0.85rem; margin-bottom: 24px; }
.meteo-note {
  background: rgba(201,168,76,0.12);
  border-left: 4px solid var(--gold);
  padding: 12px 16px;
  border-radius: 0 10px 10px 0;
  margin-bottom: 22px;
  font-size: 0.82rem;
  color: var(--dark);
}
.meteo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; }
.meteo-card {
  background: linear-gradient(160deg, var(--green), #2d6b47);
  border-radius: 16px;
  padding: 18px 16px;
  color: #fff;
  border: 1px solid rgba(201,168,76,0.2);
  cursor: pointer;
  transition: transform 0.2s;
  text-decoration: none;
  display: block;
}
.meteo-card:hover { transform: translateY(-3px); }
.mc-city { font-weight: 700; font-size: 0.95rem; }
.mc-date { font-size: 0.68rem; color: rgba(255,255,255,0.55); margin-bottom: 12px; letter-spacing: 1px; }
.mc-icon { font-size: 2.2rem; margin-bottom: 4px; }
.mc-temp { font-family: 'Playfair Display', serif; font-size: 2.4rem; color: var(--gold); line-height: 1; }
.mc-desc { font-size: 0.75rem; opacity: 0.8; margin-top: 4px; }
.mc-details { margin-top: 10px; display: flex; gap: 10px; font-size: 0.7rem; opacity: 0.65; }
.meteo-tips { margin-top: 24px; }
.meteo-tips h3 { font-family: 'Playfair Display', serif; color: var(--green); margin-bottom: 12px; }
.tip-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 10px; }
.tip { background: #fff; border-radius: 12px; padding: 14px 16px; border-left: 4px solid var(--green); font-size: 0.8rem; }
.tip strong { display: block; color: var(--green); margin-bottom: 4px; }

/* â”€â”€â”€ CALENDRIER â”€â”€â”€ */
#calendrier { padding: 24px 20px 40px; }
.cal-wrapper { max-width: 700px; }
.cal-month { margin-bottom: 30px; }
.cal-month-title { font-family: 'Playfair Display', serif; font-size: 1.4rem; color: var(--green); margin-bottom: 12px; }
.cal-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 2px;
  border-radius: 14px;
  overflow: hidden;
  box-shadow: 0 4px 24px rgba(0,0,0,0.1);
}
.cal-hdr {
  background: var(--dark);
  color: var(--gold);
  text-align: center;
  padding: 8px 2px;
  font-size: 0.65rem;
  letter-spacing: 1px;
  font-weight: 700;
}
.cal-cell {
  background: #fff;
  min-height: 72px;
  padding: 6px;
  position: relative;
}
.cal-cell.empty { background: #f0ebe2; }
.cal-cell.trip { background: #e5f0e9; cursor: pointer; }
.cal-cell.trip:hover { background: #cde3d4; }
.cal-cell.today { outline: 2px solid var(--gold); outline-offset: -2px; }
.cal-num { font-size: 0.82rem; font-weight: 700; color: #aaa; }
.cal-cell.trip .cal-num { color: var(--green); }
.cal-event-tag {
  margin-top: 3px;
  background: var(--green);
  color: #fff;
  font-size: 0.58rem;
  padding: 2px 5px;
  border-radius: 4px;
  line-height: 1.4;
  display: block;
}
.cal-event-tag.gold { background: var(--gold); color: var(--dark); }
.cal-event-tag.blue { background: var(--blue); }

/* â”€â”€â”€ STATS FOOTER â”€â”€â”€ */
.stats-row {
  background: var(--dark);
  display: flex;
  justify-content: center;
  gap: 0;
  overflow-x: auto;
  border-top: 1px solid rgba(255,255,255,0.05);
}
.stat-block {
  padding: 14px 20px;
  text-align: center;
  border-right: 1px solid rgba(255,255,255,0.05);
  min-width: 90px;
}
.stat-block strong { display: block; font-family: 'Playfair Display', serif; color: var(--gold); font-size: 1.4rem; }
.stat-block span { font-size: 0.62rem; color: rgba(255,255,255,0.45); letter-spacing: 1px; text-transform: uppercase; }

/* â”€â”€â”€ MOBILE â”€â”€â”€ */
@media (max-width: 640px) {
  #planning.active { flex-direction: column; }
  .steps-sidebar { width: 100%; min-width: unset; max-height: 40vh; border-right: none; border-bottom: 1px solid rgba(255,255,255,0.1); }
  .step-detail-panel { padding: 18px; }
  .detail-title { font-size: 1.5rem; }
  .tiles-grid { grid-template-columns: 1fr; }
  nav button { padding: 6px 8px; font-size: 0.65rem; }
  .logo { font-size: 0.9rem; }
  .meteo-grid { grid-template-columns: repeat(2, 1fr); }
  .cal-cell { min-height: 56px; }
}
</style>
</head>
<body>

<header>
  <div class="logo">
    ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ Scotland 2026
    <small>ROADTRIP Â· MARS 2026</small>
  </div>
  <nav>
    <button class="active" onclick="show('planning')">ğŸ“‹ Planning</button>
    <button onclick="show('map-section')">ğŸ—ºï¸ Carte</button>
    <button onclick="show('meteo')">â˜ï¸ MÃ©tÃ©o</button>
    <button onclick="show('calendrier')">ğŸ“… Calendrier</button>
  </nav>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PLANNING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="planning" class="section">
  <div class="steps-sidebar">
    <div class="sidebar-title">ğŸ“ Ã‰tapes du voyage</div>
    <!-- steps injected by JS -->
  </div>
  <div class="step-detail-panel">
    <!-- detail injected by JS -->
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="map-section" class="section">
  <div id="leaflet-map"></div>
  <div id="map-fallback" style="display:none; width:100%; height:100%; position:relative;">
    <iframe id="gmap-frame" width="100%" height="100%" frameborder="0" style="border:0;"
      src="https://www.google.com/maps/embed?pb=!1m76!1m8!1m3!1d2843558.0!2d-4.5!3d57.0!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m65!3e0!4m5!1s0x47ef4a0e0cc0ecef%3A0x8a7ba6a01cae7a42!2sCarlisle%2C+UK!3m2!1d54.8951!2d-2.9382!4m5!1s0x4884bb3b56c5e3a9%3A0x2e5a7b1e1e1e1e1e!2sFort+William%2C+UK!3m2!1d56.8198!2d-5.1052!4m5!1s0x488d4a39a83e4e1f%3A0x1b1b1b1b1b1b1b1b!2sIsle+of+Skye%2C+UK!3m2!1d57.5822!2d-6.2122!4m5!1s0x488f5a5a5a5a5a5a%3A0x2c2c2c2c2c2c2c2c!2sUllapool%2C+UK!3m2!1d57.9369!2d-5.1589!4m5!1s0x4888a1a1a1a1a1a1%3A0x3d3d3d3d3d3d3d3d!2sTongue%2C+UK!3m2!1d58.4807!2d-4.4204!4m5!1s0x4889a9a9a9a9a9a9%3A0x4e4e4e4e4e4e4e4e!2sInverness%2C+UK!3m2!1d57.4778!2d-4.2247!4m5!1s0x4887c78fb1d5a3c5%3A0xffe7703e0d0ca1fe!2sEdinburgh%2C+UK!3m2!1d55.9533!2d-3.1883!5e0!3m2!1sfr!2sbe!4v1234567890"
      allowfullscreen loading="lazy"></iframe>
    <div style="position:absolute;bottom:16px;left:16px;background:rgba(13,31,23,0.92);color:#fff;padding:12px 16px;border-radius:10px;border:1px solid rgba(201,168,76,0.3);font-family:Lato,sans-serif;font-size:0.75rem;max-width:200px;">
      <div style="color:#c9a84c;font-weight:700;letter-spacing:1px;margin-bottom:8px;">ğŸ—ºï¸ ITINÃ‰RAIRE</div>
      <div style="margin-bottom:3px;">ğŸ“ Carlisle</div>
      <div style="margin-bottom:3px;">ğŸ“ Fort William</div>
      <div style="margin-bottom:3px;">ğŸ“ Isle of Skye</div>
      <div style="margin-bottom:3px;">ğŸ“ Ullapool</div>
      <div style="margin-bottom:3px;">ğŸ“ Tongue</div>
      <div style="margin-bottom:3px;">ğŸ“ Inverness</div>
      <div>ğŸ“ Edinburgh</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     METEO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="meteo" class="section">
  <h2 class="page-title">â˜ï¸ MÃ©tÃ©o en Ã‰cosse</h2>
  <p class="page-sub">DonnÃ©es en temps rÃ©el via Open-Meteo Â· ActualisÃ©es Ã  chaque ouverture</p>

  <div class="meteo-note">
    â˜” <strong>Note :</strong> Les donnÃ©es affichÃ©es sont les <strong>conditions actuelles</strong> pour chaque ville de l'itinÃ©raire. Les prÃ©visions fiables n'Ã©tant disponibles que sur 14 jours, revenez sur ce site Ã  l'approche du voyage pour voir la vraie mÃ©tÃ©o de mars 2026 !
  </div>

  <div class="meteo-grid" id="meteo-grid">
    <!-- cards injected by JS -->
  </div>

  <div class="meteo-tips" style="margin-top:28px;">
    <h3>ğŸ’ Conseils pour l'Ã‰cosse en Mars</h3>
    <div class="tip-grid">
      <div class="tip"><strong>ğŸ§¥ Layering</strong>Le temps peut changer en quelques heures. Habille-toi en couches et garde un impermÃ©able accessible.</div>
      <div class="tip"><strong>ğŸŒ… Jours plus longs</strong>Mars offre de plus en plus de lumiÃ¨re â€” lever du soleil ~6h30, coucher ~18h30.</div>
      <div class="tip"><strong>ğŸ’¨ Vent dans les Highlands</strong>Les crÃªtes et cÃ´tes peuvent Ãªtre trÃ¨s venteuses. PrÃ©vois des vÃªtements coupe-vent.</div>
      <div class="tip"><strong>ğŸŒˆ LumiÃ¨re magique</strong>La lumiÃ¨re dorÃ©e de mars est idÃ©ale pour les photos de paysages !</div>
      <div class="tip"><strong>â„ï¸ Routes en altitude</strong>Quelques cols peuvent encore Ãªtre enneigÃ©s. VÃ©rifie l'Ã©tat des routes via Traffic Scotland.</div>
      <div class="tip"><strong>ğŸŒŠ Mer agitÃ©e</strong>Le ferry vers Skye peut Ãªtre annulÃ© par mauvais temps â€” prÃ©vois un plan B par le pont de Skye.</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CALENDRIER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="calendrier" class="section">
  <h2 class="page-title">ğŸ“… Calendrier du voyage</h2>
  <p class="page-sub" style="margin-bottom:20px;">Vue d'ensemble Â· FÃ©vrierâ€“Mars 2026</p>

  <div class="cal-wrapper">
    <!-- Feb -->
    <div class="cal-month">
      <div class="cal-month-title">FÃ©vrier 2026</div>
      <div class="cal-grid" id="cal-feb"></div>
    </div>
    <!-- March -->
    <div class="cal-month">
      <div class="cal-month-title">Mars 2026</div>
      <div class="cal-grid" id="cal-mar"></div>
    </div>
    <!-- April -->
    <div class="cal-month">
      <div class="cal-month-title">Avril 2026</div>
      <div class="cal-grid" id="cal-apr"></div>
    </div>
  </div>

  <!-- Stats row -->
  <div class="stats-row" style="margin-top:24px; border-radius:14px; overflow:hidden;">
    <div class="stat-block"><strong>3183</strong><span>km total</span></div>
    <div class="stat-block"><strong>11</strong><span>jours</span></div>
    <div class="stat-block"><strong>41h</strong><span>conduite</span></div>
    <div class="stat-block"><strong>8</strong><span>hÃ´tels</span></div>
    <div class="stat-block"><strong>2</strong><span>ferries</span></div>
    <div class="stat-block"><strong>1</strong><span>Eurotunnel</span></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const steps = [
  {
    day: "Jeu 26 FÃ©v",
    short: "26",
    dayShort: "JEU",
    from: "Genval",
    to: "Calais",
    km: 226,
    h: 2.5,
    hotel: null,
    hotelUrl: null,
    lat: 50.9548, lng: 1.8587,
    pois: ["Route vers la mer", "Embarquement Tunnel"],
    tiles: {
      hotel: null,
      resto: "https://www.tripadvisor.fr/Restaurants-g187064-Calais_Pas_de_Calais_Nord_Pas_de_Calais.html",
      walk: null,
      castle: null,
      nature: null,
      museum: null,
      transport: "https://www.eurotunnel.com/fr/"
    },
    notes: "DÃ©part de Genval vers Calais. Embarquement Eurotunnel en soirÃ©e vers Folkestone."
  },
  {
    day: "Jeu 26 FÃ©v",
    short: "â€”",
    dayShort: "NUIT",
    from: "Folkestone",
    to: "Carlisle",
    km: 600,
    h: 6,
    hotel: "Crown & Mitre, Carlisle",
    hotelUrl: "https://www.booking.com/hotel/gb/crown-and-mitre.fr.html",
    lat: 54.8951, lng: -2.9382,
    pois: ["ArrivÃ©e tard ~21h", "Carlisle"],
    tiles: {
      hotel: "https://www.booking.com/hotel/gb/crown-and-mitre.fr.html",
      resto: "https://www.tripadvisor.fr/Restaurants-g186385-Carlisle_Cumbria_England.html",
      walk: null,
      castle: "https://www.carlislecastle.org.uk/",
      nature: null,
      museum: null,
      transport: "https://www.eurotunnel.com/fr/"
    },
    notes: "TraversÃ©e de l'Angleterre de nuit. ArrivÃ©e Ã  Carlisle vers 21h. Repos bien mÃ©ritÃ© au Crown & Mitre."
  },
  {
    day: "Ven 27 FÃ©v",
    short: "27",
    dayShort: "VEN",
    from: "Carlisle",
    to: "Fort William",
    km: 320,
    h: 4,
    hotel: "Loch Leven Hotel",
    hotelUrl: "https://www.lochleven-hotel.co.uk/",
    lat: 56.8198, lng: -5.1052,
    pois: ["Mur d'Hadrien", "Glencoe"],
    tiles: {
      hotel: "https://www.lochleven-hotel.co.uk/",
      resto: "https://www.tripadvisor.fr/Restaurants-g551782-Fort_William_Scottish_Highlands_Scotland.html",
      walk: "https://www.walkhighlands.co.uk/lochaber/glencoe.shtml",
      castle: "https://www.english-heritage.org.uk/visit/places/housesteads-roman-fort-hadrians-wall/",
      nature: "https://www.glencoe-visitor-centre.org.uk/",
      museum: "https://www.visitscotland.com/info/see-do/glencoe-visitor-centre-p247821",
      transport: "https://www.google.com/maps/dir/Carlisle/Fort+William"
    },
    notes: "EntrÃ©e en Ã‰cosse ! ArrÃªt au Mur d'Hadrien puis route vers les Highlands via Glencoe."
  },
  {
    day: "Sam 28 FÃ©v",
    short: "28",
    dayShort: "SAM",
    from: "Fort William",
    to: "Linicro, Skye",
    km: 170,
    h: 3,
    hotel: "Monkstadt House",
    hotelUrl: "https://www.monkstadt.co.uk/",
    lat: 57.5822, lng: -6.2122,
    pois: ["Ferry Mallaig â†’ Armadale", "Cuillin Hills"],
    tiles: {
      hotel: "https://www.monkstadt.co.uk/",
      resto: "https://www.tripadvisor.fr/Restaurants-g580218-Isle_of_Skye_Scotland.html",
      walk: "https://www.walkhighlands.co.uk/skye/",
      castle: "https://www.historic-scotland.gov.uk/",
      nature: "https://www.visitscotland.com/destinations-maps/isle-of-skye/",
      museum: null,
      transport: "https://www.calmac.co.uk/route/mallaig-armadale"
    },
    notes: "Route vers Mallaig via le spectaculaire Viaduc de Glenfinnan. Ferry vers Skye !"
  },
  {
    day: "Dim 1 Mar",
    short: "1",
    dayShort: "DIM",
    from: "Linicro",
    to: "Linicro (Skye)",
    km: 0,
    h: 0,
    hotel: "Monkstadt House",
    hotelUrl: "https://www.monkstadt.co.uk/",
    lat: 57.5822, lng: -6.2122,
    pois: ["Tour Trotternish", "Old Man of Storr", "Kilt Rock", "Quiraing"],
    tiles: {
      hotel: "https://www.monkstadt.co.uk/",
      resto: "https://www.tripadvisor.fr/Restaurants-g580218-Isle_of_Skye_Scotland.html",
      walk: "https://www.walkhighlands.co.uk/skye/storr.shtml",
      castle: "https://www.duntulm.co.uk/",
      nature: "https://www.walkhighlands.co.uk/skye/quiraing.shtml",
      museum: "https://www.skye-museum.co.uk/",
      transport: null
    },
    notes: "JournÃ©e exploration de la pÃ©ninsule Trotternish. Old Man of Storr, Kilt Rock, Quiraingâ€¦"
  },
  {
    day: "Lun 2 Mar",
    short: "2",
    dayShort: "LUN",
    from: "Linicro",
    to: "Ullapool",
    km: 330,
    h: 6.5,
    hotel: "Kylesku Hotel",
    hotelUrl: "https://www.kyleskuhotel.co.uk/",
    lat: 57.9369, lng: -5.1589,
    pois: ["North Coast Tour", "Eilean Donan Castle"],
    tiles: {
      hotel: "https://www.kyleskuhotel.co.uk/",
      resto: "https://www.tripadvisor.fr/Restaurants-g551793-Ullapool_Scottish_Highlands_Scotland.html",
      walk: "https://www.visitscotland.com/destinations-maps/northern-highlands/",
      castle: "https://www.eileandonancastle.com/",
      nature: "https://www.visitscotland.com/info/see-do/inverpolly-national-nature-reserve-p245201",
      museum: null,
      transport: null
    },
    notes: "Longue route cÃ´tiÃ¨re magnifique. ArrÃªt incontournable Ã  Eilean Donan Castle !"
  },
  {
    day: "Mar 3 Mar",
    short: "3",
    dayShort: "MAR",
    from: "Ullapool",
    to: "Tongue",
    km: 111,
    h: 2.5,
    hotel: "Tongue Hotel",
    hotelUrl: "https://www.tonguehotel.co.uk/",
    lat: 58.4807, lng: -4.4204,
    pois: ["Sandwood Beach", "CÃ´te Nord"],
    tiles: {
      hotel: "https://www.tonguehotel.co.uk/",
      resto: "https://www.tripadvisor.fr/Restaurants-g551805-Tongue_Scottish_Highlands_Scotland.html",
      walk: "https://www.walkhighlands.co.uk/sutherland/sandwood-bay.shtml",
      castle: null,
      nature: "https://www.walkhighlands.co.uk/sutherland/sandwood-bay.shtml",
      museum: null,
      transport: null
    },
    notes: "Route vers le Nord le long de la cÃ´te. Sandwood Beach est l'une des plus belles plages sauvages d'Ã‰cosse."
  },
  {
    day: "Mer 4 Mar",
    short: "4",
    dayShort: "MER",
    from: "Tongue",
    to: "Tongue (repos)",
    km: 0,
    h: 0,
    hotel: "Tongue Hotel",
    hotelUrl: "https://www.tonguehotel.co.uk/",
    lat: 58.4807, lng: -4.4204,
    pois: ["Smoo Cave", "Kyle of Tongue"],
    tiles: {
      hotel: "https://www.tonguehotel.co.uk/",
      resto: "https://www.tripadvisor.fr/Restaurants-g551805-Tongue_Scottish_Highlands_Scotland.html",
      walk: "https://www.walkhighlands.co.uk/sutherland/smoo-cave.shtml",
      castle: null,
      nature: "https://www.visitscotland.com/info/see-do/smoo-cave-p247751",
      museum: null,
      transport: null
    },
    notes: "JournÃ©e explorations locales. La Smoo Cave est impressionnante, et la vue sur Kyle of Tongue inoubliable."
  },
  {
    day: "Jeu 5 Mar",
    short: "5",
    dayShort: "JEU",
    from: "Tongue",
    to: "Inverness",
    km: 190,
    h: 3,
    hotel: "Lochardil House",
    hotelUrl: "https://www.lochardilhouse.co.uk/",
    lat: 57.4778, lng: -4.2247,
    pois: ["Dunrobin Castle", "Dornoch"],
    tiles: {
      hotel: "https://www.lochardilhouse.co.uk/",
      resto: "https://www.tripadvisor.fr/Restaurants-g186543-Inverness_Scottish_Highlands_Scotland.html",
      walk: "https://www.walkhighlands.co.uk/inverness/",
      castle: "https://www.dunrobincastle.co.uk/",
      nature: null,
      museum: "https://www.inverness-museum.com/",
      transport: null
    },
    notes: "Retour vers Inverness via l'est. ArrÃªt Ã  Dunrobin Castle, le plus grand chÃ¢teau des Highlands."
  },
  {
    day: "Ven 6 Mar",
    short: "6",
    dayShort: "VEN",
    from: "Inverness",
    to: "Edinburgh",
    km: 250,
    h: 3,
    hotel: "Ibis Edinburgh",
    hotelUrl: "https://all.accor.com/hotel/6444/index.fr.shtml",
    lat: 55.9533, lng: -3.1883,
    pois: ["Whisky Bar", "Royal Mile", "Edinburgh Castle"],
    tiles: {
      hotel: "https://all.accor.com/hotel/6444/index.fr.shtml",
      resto: "https://www.tripadvisor.fr/Restaurants-g186525-Edinburgh_Scotland.html",
      walk: "https://www.walkhighlands.co.uk/lothian/",
      castle: "https://www.edinburghcastle.scot/",
      nature: "https://www.holyrood.info/",
      museum: "https://www.nms.ac.uk/national-museum-of-scotland/",
      transport: null
    },
    notes: "ArrivÃ©e Ã  Edinburgh ! SoirÃ©e sur le Royal Mile, whisky bar, atmosphÃ¨re unique."
  },
  {
    day: "Sam 7 Mar",
    short: "7",
    dayShort: "SAM",
    from: "Edinburgh",
    to: "Cambridge",
    km: 570,
    h: 6,
    hotel: "Ã€ confirmer",
    hotelUrl: "https://www.booking.com/city/gb/cambridge.fr.html",
    lat: 52.2053, lng: 0.1218,
    pois: ["Route retour", "Cambridge"],
    tiles: {
      hotel: "https://www.booking.com/city/gb/cambridge.fr.html",
      resto: "https://www.tripadvisor.fr/Restaurants-g186225-Cambridge_Cambridgeshire_England.html",
      walk: "https://www.visitcambridge.org/things-to-do/punting/",
      castle: null,
      nature: null,
      museum: "https://www.fitzmuseum.cam.ac.uk/",
      transport: "https://www.google.com/maps/dir/Edinburgh/Cambridge"
    },
    notes: "Grande route de retour vers le sud. Nuit Ã  Cambridge."
  },
  {
    day: "Dim 8 Mar",
    short: "8",
    dayShort: "DIM",
    from: "Cambridge",
    to: "Genval",
    km: 190 + 226,
    h: 4.5,
    hotel: "Maison ğŸ¡",
    hotelUrl: null,
    lat: 50.6292, lng: 4.5833,
    pois: ["Folkestone â†’ Calais", "Retour Genval"],
    tiles: {
      hotel: null,
      resto: null,
      walk: null,
      castle: null,
      nature: null,
      museum: null,
      transport: "https://www.eurotunnel.com/fr/"
    },
    notes: "Retour en Belgique via l'Eurotunnel. Fin d'un beau voyage !"
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLANNING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentStep = 0;

function renderSidebar() {
  const sidebar = document.querySelector('.steps-sidebar');
  const inner = steps.map((s, i) => `
    <div class="step-item ${i === currentStep ? 'active' : ''}" onclick="selectStep(${i})">
      <div class="step-num">${s.short}<small>${s.dayShort}</small></div>
      <div>
        <div class="step-name">${s.to}</div>
        <div class="step-from">Depuis ${s.from}</div>
      </div>
      <div class="step-km-badge">${s.km > 0 ? s.km + 'km' : 'ğŸ '}<small>${s.h > 0 ? s.h + 'h' : 'JournÃ©e'}</small></div>
    </div>
  `).join('');
  sidebar.innerHTML = '<div class="sidebar-title">ğŸ“ Ã‰tapes du voyage</div>' + inner;
}

function tileName(type) {
  const names = { hotel:'HÃ©bergement', resto:'Restaurants', walk:'Balades', castle:'ChÃ¢teaux & Sites', nature:'Plages & Nature', museum:'MusÃ©es', transport:'Transports' };
  return names[type];
}
function tileIcon(type) {
  const icons = { hotel:'ğŸ¨', resto:'ğŸ½ï¸', walk:'ğŸ¥¾', castle:'ğŸ°', nature:'ğŸŒŠ', museum:'ğŸ›ï¸', transport:'ğŸš¢' };
  return icons[type];
}
function tileClass(type) {
  return 't-' + type;
}
function tileDesc(type, s) {
  const descs = {
    hotel: s.hotel || 'Voir les hÃ©bergements',
    resto: 'Restaurants & pubs locaux',
    walk: 'Sentiers & randonnÃ©es',
    castle: 'ChÃ¢teaux & monuments historiques',
    nature: 'Plages, cascades & parcs',
    museum: 'MusÃ©es & expositions',
    transport: 'Ferries, tunnels & transports'
  };
  return descs[type];
}

function renderDetail(i) {
  const s = steps[i];
  const panel = document.querySelector('.step-detail-panel');

  const tileHTML = Object.entries(s.tiles).map(([type, url]) => {
    if (!url) return '';
    return `
      <a href="${url}" target="_blank" class="tile ${tileClass(type)}">
        <div class="tile-icon">${tileIcon(type)}</div>
        <div class="tile-body">
          <strong>${tileName(type)}</strong>
          <span>${tileDesc(type, s)}</span>
        </div>
      </a>
    `;
  }).join('');

  const poiHTML = s.pois.length ? `
    <div class="poi-block">
      <div class="tiles-section-title">â­ Points d'intÃ©rÃªt</div>
      <div class="poi-list">${s.pois.map(p => `<span class="poi-chip">${p}</span>`).join('')}</div>
    </div>
  ` : '';

  panel.innerHTML = `
    <div class="detail-header">
      <div class="detail-day-label">${s.day}</div>
      <div class="detail-title">${s.to}</div>
      <div class="detail-subtitle">Depuis ${s.from}</div>
    </div>
    ${s.km > 0 ? `
    <div class="detail-stats">
      <div class="dstat"><strong>${s.km} km</strong><span>Distance</span></div>
      <div class="dstat"><strong>${s.h}h</strong><span>Conduite</span></div>
      ${s.hotel ? `<div class="dstat"><strong>ğŸ¨</strong><span>${s.hotel.split(',')[0]}</span></div>` : ''}
    </div>` : ''}
    <p style="margin-bottom:20px; color:var(--mist); font-size:0.85rem; line-height:1.6;">${s.notes}</p>
    <div class="tiles-section-title">ğŸ—‚ï¸ Ressources par thÃ¨me</div>
    <div class="tiles-grid">${tileHTML}</div>
    ${poiHTML}
  `;
}

function selectStep(i) {
  currentStep = i;
  renderSidebar();
  renderDetail(i);
  // scroll map
  if (mapInstance) {
    mapInstance.setView([steps[i].lat, steps[i].lng], 9);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let mapInstance = null;
let mapInitialized = false;

function initMap() {
  if (mapInitialized) return;
  mapInitialized = true;

  // Check if Leaflet loaded
  if (typeof L === 'undefined') {
    document.getElementById('leaflet-map').style.display = 'none';
    document.getElementById('map-fallback').style.display = 'block';
    return;
  }

  try {
  mapInstance = L.map('leaflet-map').setView([57.0, -4.5], 6);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors',
    maxZoom: 18
  }).addTo(mapInstance);

  // Route line
  const coords = steps.filter(s => s.km > 0 || s === steps[steps.length - 1]).map(s => [s.lat, s.lng]);
  L.polyline(coords, { color: '#c9a84c', weight: 3, opacity: 0.8, dashArray: '8,5' }).addTo(mapInstance);

  // Markers
  steps.forEach((s, i) => {
    const color = i === 0 || i === steps.length - 1 ? '#c9a84c' : '#1a3a2a';
    const marker = L.circleMarker([s.lat, s.lng], {
      radius: 8,
      fillColor: color,
      color: '#fff',
      weight: 2,
      opacity: 1,
      fillOpacity: 1
    }).addTo(mapInstance);

    marker.bindPopup(`
      <div style="font-family:Lato,sans-serif; min-width:180px;">
        <strong style="color:#1a3a2a; font-size:1rem;">${s.to}</strong><br>
        <span style="color:#7a9a8a; font-size:0.75rem;">${s.day}</span>
        ${s.hotel ? `<br><span style="color:#8b3a1a;">ğŸ¨ ${s.hotel}</span>` : ''}
        ${s.km > 0 ? `<br><span style="color:#c9a84c;">${s.km} km Â· ${s.h}h de route</span>` : ''}
        <br><br>
        ${s.pois.map(p => `<span style="background:#e5f0e9;color:#1a3a2a;padding:2px 7px;border-radius:50px;font-size:0.7rem;margin-right:3px;">${p}</span>`).join('')}
      </div>
    `);

    marker.on('click', () => {
      selectStep(i);
      show('planning');
    });
  });

  // Legend
  const legend = L.control({ position: 'bottomleft' });
  legend.onAdd = function() {
    const div = L.DomUtil.create('div');
    div.innerHTML = `
      <div style="background:rgba(13,31,23,0.9);color:#fff;padding:12px 16px;border-radius:10px;border:1px solid rgba(201,168,76,0.3);font-family:Lato,sans-serif;font-size:0.75rem;">
        <div style="color:#c9a84c;font-weight:700;letter-spacing:1px;margin-bottom:8px;">ITINÃ‰RAIRE</div>
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px;"><div style="width:20px;height:3px;background:#c9a84c;border-radius:2px;"></div> Route</div>
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px;"><div style="width:10px;height:10px;border-radius:50%;background:#1a3a2a;border:2px solid #fff;"></div> Ã‰tape nuit</div>
        <div style="display:flex;align-items:center;gap:6px;"><div style="width:10px;height:10px;border-radius:50%;background:#c9a84c;border:2px solid #fff;"></div> DÃ©part/ArrivÃ©e</div>
      </div>
    `;
    return div;
  };
  legend.addTo(mapInstance);
  } catch(e) {
    console.error('Leaflet error:', e);
    document.getElementById('leaflet-map').style.display = 'none';
    document.getElementById('map-fallback').style.display = 'block';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ‰TÃ‰O
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const weatherLocations = [
  { city: "Carlisle",      day: "Jeu 26 FÃ©v", lat: 54.8951, lng: -2.9382 },
  { city: "Fort William",  day: "Ven 27 FÃ©v", lat: 56.8198, lng: -5.1052 },
  { city: "Isle of Skye",  day: "Samâ€“Dim",    lat: 57.5822, lng: -6.2122 },
  { city: "Ullapool",      day: "Lun 2 Mar",  lat: 57.8960, lng: -5.1589 },
  { city: "Tongue",        day: "Marâ€“Mer",    lat: 58.4807, lng: -4.4204 },
  { city: "Inverness",     day: "Jeu 5 Mar",  lat: 57.4778, lng: -4.2247 },
  { city: "Edinburgh",     day: "Ven 6 Mar",  lat: 55.9533, lng: -3.1883 },
  { city: "Cambridge",     day: "Sam 7 Mar",  lat: 52.2053, lng:  0.1218 }
];

const WMO_CODES = {
  0:  ["â˜€ï¸","Ciel dÃ©gagÃ©"],
  1:  ["ğŸŒ¤ï¸","Peu nuageux"], 2: ["â›…","Partiellement nuageux"], 3: ["â˜ï¸","Couvert"],
  45: ["ğŸŒ«ï¸","Brouillard"], 48: ["ğŸŒ«ï¸","Brouillard givrant"],
  51: ["ğŸŒ¦ï¸","Bruine lÃ©gÃ¨re"], 53: ["ğŸŒ¦ï¸","Bruine modÃ©rÃ©e"], 55: ["ğŸŒ§ï¸","Bruine dense"],
  61: ["ğŸŒ§ï¸","Pluie lÃ©gÃ¨re"], 63: ["ğŸŒ§ï¸","Pluie modÃ©rÃ©e"], 65: ["ğŸŒ§ï¸","Pluie forte"],
  71: ["ğŸŒ¨ï¸","Neige lÃ©gÃ¨re"], 73: ["ğŸŒ¨ï¸","Neige modÃ©rÃ©e"], 75: ["â„ï¸","Neige forte"],
  80: ["ğŸŒ¦ï¸","Averses lÃ©gÃ¨res"], 81: ["ğŸŒ§ï¸","Averses modÃ©rÃ©es"], 82: ["â›ˆï¸","Averses fortes"],
  85: ["ğŸŒ¨ï¸","Averses de neige"], 86: ["â„ï¸","Averses neige forte"],
  95: ["â›ˆï¸","Orage"], 96: ["â›ˆï¸","Orage & grÃªle"], 99: ["â›ˆï¸","Orage fort & grÃªle"]
};

async function fetchWeather(loc) {
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lng}`
    + `&current=temperature_2m,apparent_temperature,relative_humidity_2m,wind_speed_10m,weather_code`
    + `&wind_speed_unit=kmh&temperature_unit=celsius&timezone=Europe%2FLondon`;
  const res = await fetch(url);
  const data = await res.json();
  const c = data.current;
  const [icon, desc] = WMO_CODES[c.weather_code] || ["ğŸŒ¡ï¸","Inconnu"];
  return {
    city: loc.city,
    day: loc.day,
    icon,
    desc,
    temp: Math.round(c.temperature_2m),
    feel: Math.round(c.apparent_temperature),
    wind: Math.round(c.wind_speed_10m) + " km/h",
    hum: Math.round(c.relative_humidity_2m) + "%"
  };
}

async function renderMeteo() {
  const grid = document.getElementById('meteo-grid');
  // Show skeleton loaders
  grid.innerHTML = weatherLocations.map(l => `
    <div class="meteo-card" style="opacity:0.5;">
      <div class="mc-city">${l.city}</div>
      <div class="mc-date">${l.day}</div>
      <div class="mc-icon">â³</div>
      <div class="mc-temp">--Â°C</div>
      <div class="mc-desc">Chargement...</div>
    </div>
  `).join('');

  // Fetch all in parallel
  const results = await Promise.allSettled(weatherLocations.map(fetchWeather));

  grid.innerHTML = results.map((r, i) => {
    const loc = weatherLocations[i];
    if (r.status === 'rejected') {
      return `
        <div class="meteo-card" style="opacity:0.6;">
          <div class="mc-city">${loc.city}</div>
          <div class="mc-date">${loc.day}</div>
          <div class="mc-icon">âŒ</div>
          <div class="mc-desc">DonnÃ©es indisponibles</div>
        </div>`;
    }
    const w = r.value;
    return `
      <a href="https://open-meteo.com/" target="_blank" class="meteo-card">
        <div class="mc-city">${w.city}</div>
        <div class="mc-date">${w.day}</div>
        <div class="mc-icon">${w.icon}</div>
        <div class="mc-temp">${w.temp}Â°C</div>
        <div class="mc-desc">${w.desc}</div>
        <div class="mc-details">
          <span>ğŸ’¨ ${w.wind}</span>
          <span>ğŸ’§ ${w.hum}</span>
          <span>ğŸŒ¡ï¸ Ressenti ${w.feel}Â°C</span>
        </div>
      </a>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALENDRIER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const tripDays = {
  // Feb
  "2026-02-26": { label: "DÃ©part Genval", type: "gold" },
  // March
  "2026-02-27": { label: "â†’ Carlisle", type: "normal" },
  "2026-02-28": { label: "â†’ Fort William", type: "normal" },
  "2026-03-01": { label: "â†’ Skye", type: "normal" },
  "2026-03-02": { label: "Skye tour", type: "normal" },
  "2026-03-03": { label: "â†’ Ullapool", type: "normal" },
  "2026-03-04": { label: "â†’ Tongue", type: "normal" },
  "2026-03-05": { label: "Smoo Cave", type: "normal" },
  "2026-03-06": { label: "â†’ Inverness", type: "normal" },
  "2026-03-07": { label: "â†’ Edinburgh", type: "normal" },
  "2026-03-08": { label: "â†’ Cambridge", type: "normal" },
  "2026-03-09": { label: "Retour Genval", type: "gold" }
};

function buildCal(containerId, year, month) {
  const container = document.getElementById(containerId);
  const days = ['LUN','MAR','MER','JEU','VEN','SAM','DIM'];
  let html = days.map(d => `<div class="cal-hdr">${d}</div>`).join('');
  
  const firstDay = new Date(year, month - 1, 1);
  let startDow = firstDay.getDay(); // 0=Sun
  startDow = startDow === 0 ? 6 : startDow - 1; // convert to Mon=0
  
  for (let e = 0; e < startDow; e++) html += `<div class="cal-cell empty"></div>`;
  
  const daysInMonth = new Date(year, month, 0).getDate();
  for (let d = 1; d <= daysInMonth; d++) {
    const key = `${year}-${String(month).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const trip = tripDays[key];
    html += `
      <div class="cal-cell ${trip ? 'trip' : ''}" ${trip ? `onclick="goToDay('${key}')"` : ''}>
        <div class="cal-num">${d}</div>
        ${trip ? `<span class="cal-event-tag ${trip.type}">${trip.label}</span>` : ''}
      </div>
    `;
  }
  container.innerHTML = html;
}

function goToDay(key) {
  const map = {
    "2026-02-26": 0,
    "2026-02-27": 1,
    "2026-02-28": 2,
    "2026-03-01": 3,
    "2026-03-02": 4,
    "2026-03-03": 5,
    "2026-03-04": 6,
    "2026-03-05": 7,
    "2026-03-06": 8,
    "2026-03-07": 9,
    "2026-03-08": 10,
    "2026-03-09": 11
  };
  if (map[key] !== undefined) {
    selectStep(map[key]);
    show('planning');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function show(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));

  document.getElementById(id).classList.add('active');
  const idx = ['planning','map-section','meteo','calendrier'].indexOf(id);
  document.querySelectorAll('nav button')[idx].classList.add('active');

  if (id === 'map-section') {
    const mapEl = document.getElementById('leaflet-map');
    mapEl.style.height = (window.innerHeight - 60) + 'px';
    mapEl.style.width = '100%';
    if (!mapInitialized) {
      setTimeout(() => { initMap(); }, 250);
    } else {
      setTimeout(() => { mapInstance.invalidateSize(true); }, 100);
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  renderSidebar();
  renderDetail(0);
  renderMeteo(); // async, loads live weather
  buildCal('cal-feb', 2026, 2);
  buildCal('cal-mar', 2026, 3);
  buildCal('cal-apr', 2026, 4);
});
</script>
</body>
</html>